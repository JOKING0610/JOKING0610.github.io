<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <!-- è§†å£è®¾ç½®ï¼šç¡®ä¿ç§»åŠ¨ç«¯æ­£ç¡®ç¼©æ”¾ï¼Œç¦æ­¢ç”¨æˆ·ç¼©æ”¾ä»¥ä¿æŒæœ€ä½³æ˜¾ç¤ºæ•ˆæœ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ–°æ˜¥çƒŸèŠ± Â· çº¢é‡‘å¹´åï¼ˆæ¨ªå±å¼•å¯¼ï¼‰</title>
    <style>
        /* å…¨å±€ä¿ç•™é»‘åº•ï¼Œè®©çƒŸèŠ±æ›´å¤ºç›® */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
            /* ç§»åŠ¨ç«¯ç‚¹å‡»å…ƒç´ æ—¶å»é™¤é»˜è®¤é«˜äº® */
            -webkit-tap-highlight-color: transparent;
        }
        .music {
            display: none;
        }

        /* æ–°æ˜¥ä¸»é¢˜æ’­æ”¾å¡ç‰‡ â€”â€” çº¢é‡‘é…è‰²ï¼Œå“åº”å¼å°ºå¯¸ */
        .play-card {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, #d32f2f 0%, #b71c1c 40%, #ff8f00 100%);
            border-radius: min(30px, 8vw);
            padding: min(40px, 8vw) min(70px, 12vw);
            text-align: center;
            box-shadow: 0 15px 40px rgba(230, 30, 30, 0.6), 0 0 30px rgba(255, 215, 0, 0.5);
            border: min(2px, 0.6vw) solid #ffd966;
            z-index: 10000;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: springPulse 2.2s infinite;
            max-width: 85vw;
            box-sizing: border-box;
            white-space: nowrap;
        }

        /* æ‰‹æœºå°å±æ—¶é€‚å½“ç¼©å°å­—ä½“å’Œå†…è¾¹è· */
        @media (max-width: 600px) {
            .play-card {
                padding: min(30px, 6vw) min(40px, 8vw);
            }
            .play-card-title {
                font-size: min(28px, 7vw);
            }
            .play-card-text {
                font-size: min(16px, 4vw);
            }
            .play-card-icon {
                width: min(70px, 15vw);
                height: min(70px, 15vw);
                margin-bottom: 15px;
            }
            .play-card-icon::before {
                border-left: min(28px, 7vw) solid #b71c1c;
                border-top: min(18px, 4vw) solid transparent;
                border-bottom: min(18px, 4vw) solid transparent;
                margin-left: min(8px, 2vw);
            }
        }

        .play-card:hover {
            transform: translate(-50%, -50%) scale(1.08);
            box-shadow: 0 20px 60px rgba(230, 30, 30, 0.8), 0 0 50px #ffb300;
            border-color: #ffeb9c;
        }

        .play-card-icon {
            width: min(90px, 18vw);
            height: min(90px, 18vw);
            margin: 0 auto min(25px, 5vw);
            background: radial-gradient(circle at 30% 30%, #ffeb9c, #ff8c00);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 25px #ffd700;
            border: min(3px, 0.8vw) solid #fff2b5;
        }

        .play-card-icon::before {
            content: '';
            width: 0;
            height: 0;
            border-left: min(36px, 8vw) solid #b71c1c;
            border-top: min(22px, 5vw) solid transparent;
            border-bottom: min(22px, 5vw) solid transparent;
            margin-left: min(12px, 2.5vw);
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }

        .play-card-title {
            font-size: min(32px, 8vw);
            font-weight: 900;
            color: #ffecb3;
            text-shadow: 0 2px 10px #ff6f00, 0 0 20px #ffd700;
            letter-spacing: 0.1em;
            margin-bottom: min(12px, 3vw);
            font-family: 'Microsoft YaHei', sans-serif;
        }

        .play-card-text {
            font-size: min(18px, 5vw);
            color: #ffe082;
            text-shadow: 0 2px 5px #b71c1c;
            font-weight: 500;
            letter-spacing: 0.1em;
        }

        @keyframes springPulse {
            0% { box-shadow: 0 15px 40px rgba(230, 30, 30, 0.6), 0 0 30px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 20px 55px rgba(255, 60, 60, 0.9), 0 0 55px #ffcc00; }
            100% { box-shadow: 0 15px 40px rgba(230, 30, 30, 0.6), 0 0 30px rgba(255, 215, 0, 0.5); }
        }

        /* canvas åˆå§‹é€æ˜ï¼Œç‚¹å‡»åæ·¡å…¥ï¼›æ‰€æœ‰canvaså¼ºåˆ¶å¡«æ»¡å±å¹•ä¸”ä¸æ¨¡ç³Š */
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
            opacity: 0;
            transition: opacity 1.2s ease;
            pointer-events: none;
        }
        #fireworkCanvas {
            z-index: 1;
            pointer-events: none;
        }
        #canvas {
            z-index: 8888;
        }
        .canvas {
            z-index: 9999;
        }
        .overlay {
            display: none;
        }

        /* æ¨ªå±æç¤ºå±‚ - åªåœ¨ç«–å±æ—¶æ˜¾ç¤ºï¼Œä¸é˜»æŒ¡ç‚¹å‡» */
        .rotate-hint {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10001; /* é«˜äºå¡ç‰‡å’Œcanvas */
            pointer-events: none; /* è®©ç‚¹å‡»å¯ä»¥ç©¿é€åˆ°ä¸‹å±‚å¡ç‰‡/canvas */
            opacity: 0;
            transition: opacity 0.3s ease;
            color: white;
            font-family: 'Microsoft YaHei', sans-serif;
            text-align: center;
        }
        .rotate-hint.visible {
            opacity: 1;
        }
        .rotate-icon {
            width: min(120px, 30vw);
            height: min(120px, 30vw);
            margin-bottom: min(20px, 5vw);
            border: min(4px, 1vw) solid rgba(255, 215, 0, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: rotate-phone 2s infinite ease-in-out;
            background: rgba(255, 200, 50, 0.2);
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.5);
        }
        .rotate-icon::after {
            content: 'ğŸ“±';
            font-size: min(60px, 15vw);
            transform: rotate(-90deg);
            display: block;
        }
        .rotate-hint p {
            font-size: min(24px, 6vw);
            font-weight: bold;
            text-shadow: 0 2px 10px #b71c1c;
            margin: min(10px, 2vw) 0;
        }
        .rotate-hint small {
            font-size: min(16px, 4vw);
            opacity: 0.9;
        }
        @keyframes rotate-phone {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(-90deg); }
            100% { transform: rotate(0deg); }
        }
    </style>
</head>
<body>

    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="bgMusic" loop preload="auto">
        <source src="yanhua.mp3" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ audio å…ƒç´ ã€‚
    </audio>

    <!-- æ–°æ˜¥çº¢é‡‘æ’­æ”¾å¡ç‰‡ -->
    <div id="playCard" class="play-card">
        <div class="play-card-icon"></div>
        <div class="play-card-title">æ­è´ºæ–°ç¦§</div>
        <div class="play-card-text">ç‚¹å‡»å¼€å¯ Â· çº¢è¿çƒŸèŠ±</div>
    </div>

    <!-- æ¨ªå±æç¤ºå±‚ï¼ˆåˆå§‹éšè—ï¼‰ -->
    <div id="rotateHint" class="rotate-hint">
        <div class="rotate-icon"></div>
        <p>ä¸ºäº†æ›´å¥½çš„ä½“éªŒ</p>
        <p>è¯·å°†è®¾å¤‡æ—‹è½¬è‡³æ¨ªå±</p>
        <small>âœ¨ çƒŸèŠ±åœ¨æ¨ªå±ä¸‹æ›´ç»šçƒ‚ âœ¨</small>
    </div>

    <!-- ä¸‰ä¸ªcanvas -->
    <canvas id="fireworkCanvas"></canvas>
    <canvas id="canvas"></canvas>
    <canvas class="canvas"></canvas>

    <div class="overlay">
        <div class="tabs">
            <div class="tabs-labels"><span class="tabs-label">Commands</span><span class="tabs-label">Info</span><span class="tabs-label">Share</span></div>
            <div class="tabs-panels">
                <ul class="tabs-panel commands"></ul>
            </div>
        </div>
    </div>

    <script>
        // ==================== å·¥å…·å‡½æ•°ï¼šé€‚é…è®¾å¤‡åƒç´ æ¯”ï¼Œä½¿canvasæ¸…æ™° ====================
        function resizeCanvasWithDPI(canvas, width, height) {
            const dpr = window.devicePixelRatio || 1;
            canvas.style.width = width + 'px';
            canvas.style.height = height + 'px';
            canvas.width = width * dpr;
            canvas.height = height * dpr;
            const ctx = canvas.getContext('2d');
            ctx.scale(dpr, dpr);
            return ctx;
        }

        // ==================== åŸ3Dç²’å­çƒŸèŠ±ï¼ˆè°ƒæ•´resizeé€»è¾‘ï¼‰ ====================
        function initVars() {
            pi = Math.PI;
            ctx = canvas.getContext("2d");
            const rect = canvas.parentNode ? canvas.parentNode.getBoundingClientRect() : { width: window.innerWidth, height: window.innerHeight };
            const w = rect.width, h = rect.height;
            resizeCanvasWithDPI(canvas, w, h);
            cx = canvas.width / 2 / (window.devicePixelRatio || 1);
            cy = canvas.height / 2 / (window.devicePixelRatio || 1);
            playerZ = -25;
            playerX = playerY = playerVX = playerVY = playerVZ = pitch = yaw = pitchV = yawV = 0;
            scale = 600;
            seedTimer = 0; seedInterval = 5; seedLife = 100; gravity = .02;
            seeds = [];
            sparkPics = [];
            s = "https://cantelope.org/NYE/";
            for (i = 1; i <= 10; ++i) {
                sparkPic = new Image();
                sparkPic.src = s + "spark" + i + ".png";
                sparkPics.push(sparkPic);
            }
            sparks = [];
            pow1 = new Audio(s + "pow1.ogg");
            pow2 = new Audio(s + "pow2.ogg");
            pow3 = new Audio(s + "pow3.ogg");
            pow4 = new Audio(s + "pow4.ogg");
            frames = 0;
        }

        // å…¶ä½™3Då‡½æ•°ä¿æŒä¸å˜ (rasterizePoint, spawnSeed, splode, doLogic, rgb, draw, frame)
        function rasterizePoint(x, y, z) {
            var p, d;
            x -= playerX;
            y -= playerY;
            z -= playerZ;
            p = Math.atan2(x, z);
            d = Math.sqrt(x * x + z * z);
            x = Math.sin(p - yaw) * d;
            z = Math.cos(p - yaw) * d;
            p = Math.atan2(y, z);
            d = Math.sqrt(y * y + z * z);
            y = Math.sin(p - pitch) * d;
            z = Math.cos(p - pitch) * d;
            var rx1 = -1000, ry1 = 1, rx2 = 1000, ry2 = 1, rx3 = 0, ry3 = 0, rx4 = x, ry4 = z, uc = (ry4 - ry3) * (rx2 - rx1) - (rx4 - rx3) * (ry2 - ry1);
            if (!uc) return { x: 0, y: 0, d: -1 };
            var ua = ((rx4 - rx3) * (ry1 - ry3) - (ry4 - ry3) * (rx1 - rx3)) / uc;
            var ub = ((rx2 - rx1) * (ry1 - ry3) - (ry2 - ry1) * (rx1 - rx3)) / uc;
            if (!z) z = .000000001;
            if (ua > 0 && ua < 1 && ub > 0 && ub < 1) {
                return {
                    x: cx + (rx1 + ua * (rx2 - rx1)) * scale,
                    y: cy + y / z * scale,
                    d: Math.sqrt(x * x + y * y + z * z)
                };
            } else {
                return {
                    x: cx + (rx1 + ua * (rx2 - rx1)) * scale,
                    y: cy + y / z * scale,
                    d: -1
                };
            }
        }

        function spawnSeed() {
            seed = new Object();
            seed.x = -50 + Math.random() * 100;
            seed.y = 25;
            seed.z = -50 + Math.random() * 100;
            seed.vx = .1 - Math.random() * .2;
            seed.vy = -1.5;
            seed.vz = .1 - Math.random() * .2;
            seed.born = frames;
            seeds.push(seed);
        }

        function splode(x, y, z) {
            t = 5 + parseInt(Math.random() * 150);
            sparkV = 1 + Math.random() * 2.5;
            type = parseInt(Math.random() * 3);
            switch (type) {
                case 0: pic1 = parseInt(Math.random() * 10); break;
                case 1:
                    pic1 = parseInt(Math.random() * 10);
                    do { pic2 = parseInt(Math.random() * 10); } while (pic2 == pic1);
                    break;
                case 2:
                    pic1 = parseInt(Math.random() * 10);
                    do { pic2 = parseInt(Math.random() * 10); } while (pic2 == pic1);
                    do { pic3 = parseInt(Math.random() * 10); } while (pic3 == pic1 || pic3 == pic2);
                    break;
            }
            for (m = 1; m < t; ++m) {
                spark = new Object();
                spark.x = x; spark.y = y; spark.z = z;
                p1 = pi * 2 * Math.random();
                p2 = pi * Math.random();
                v = sparkV * (1 + Math.random() / 6)
                spark.vx = Math.sin(p1) * Math.sin(p2) * v;
                spark.vz = Math.cos(p1) * Math.sin(p2) * v;
                spark.vy = Math.cos(p2) * v;
                switch (type) {
                    case 0: spark.img = sparkPics[pic1]; break;
                    case 1: spark.img = sparkPics[parseInt(Math.random() * 2) ? pic1 : pic2]; break;
                    case 2:
                        switch (parseInt(Math.random() * 3)) {
                            case 0: spark.img = sparkPics[pic1]; break;
                            case 1: spark.img = sparkPics[pic2]; break;
                            case 2: spark.img = sparkPics[pic3]; break;
                        }
                        break;
                }
                spark.radius = 25 + Math.random() * 50;
                spark.alpha = 1;
                spark.trail = [];
                sparks.push(spark);
            }
            switch (parseInt(Math.random() * 4)) {
                case 0: pow = new Audio(s + "pow1.ogg"); break;
                case 1: pow = new Audio(s + "pow2.ogg"); break;
                case 2: pow = new Audio(s + "pow3.ogg"); break;
                case 3: pow = new Audio(s + "pow4.ogg"); break;
            }
            d = Math.sqrt((x - playerX) * (x - playerX) + (y - playerY) * (y - playerY) + (z - playerZ) * (z - playerZ));
            pow.volume = 1.5 / (1 + d / 10);
            pow.play();
        }

        function doLogic() {
            if (seedTimer < frames) {
                seedTimer = frames + seedInterval * Math.random() * 10;
                spawnSeed();
            }
            for (i = 0; i < seeds.length; ++i) {
                seeds[i].vy += gravity;
                seeds[i].x += seeds[i].vx;
                seeds[i].y += seeds[i].vy;
                seeds[i].z += seeds[i].vz;
                if (frames - seeds[i].born > seedLife) {
                    splode(seeds[i].x, seeds[i].y, seeds[i].z);
                    seeds.splice(i, 1);
                }
            }
            for (i = 0; i < sparks.length; ++i) {
                if (sparks[i].alpha > 0 && sparks[i].radius > 5) {
                    sparks[i].alpha -= .01;
                    sparks[i].radius /= 1.02;
                    sparks[i].vy += gravity;
                    point = new Object();
                    point.x = sparks[i].x;
                    point.y = sparks[i].y;
                    point.z = sparks[i].z;
                    if (sparks[i].trail.length) {
                        x = sparks[i].trail[sparks[i].trail.length - 1].x;
                        y = sparks[i].trail[sparks[i].trail.length - 1].y;
                        z = sparks[i].trail[sparks[i].trail.length - 1].z;
                        d = ((point.x - x) * (point.x - x) + (point.y - y) * (point.y - y) + (point.z - z) * (point.z - z));
                        if (d > 9) { sparks[i].trail.push(point); }
                    } else { sparks[i].trail.push(point); }
                    if (sparks[i].trail.length > 5) sparks[i].trail.splice(0, 1);
                    sparks[i].x += sparks[i].vx;
                    sparks[i].y += sparks[i].vy;
                    sparks[i].z += sparks[i].vz;
                    sparks[i].vx /= 1.075;
                    sparks[i].vy /= 1.075;
                    sparks[i].vz /= 1.075;
                } else {
                    sparks.splice(i, 1);
                }
            }
            p = Math.atan2(playerX, playerZ);
            d = Math.sqrt(playerX * playerX + playerZ * playerZ);
            d += Math.sin(frames / 80) / 1.25;
            t = Math.sin(frames / 200) / 40;
            playerX = Math.sin(p + t) * d;
            playerZ = Math.cos(p + t) * d;
            yaw = pi + p + t;
        }

        function rgb(col) {
            var r = parseInt((.5 + Math.sin(col) * .5) * 16);
            var g = parseInt((.5 + Math.cos(col) * .5) * 16);
            var b = parseInt((.5 - Math.sin(col) * .5) * 16);
            return "#" + r.toString(16) + g.toString(16) + b.toString(16);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width / (window.devicePixelRatio || 1), canvas.height / (window.devicePixelRatio || 1));
            ctx.fillStyle = "#ff8";
            for (i = -100; i < 100; i += 3) {
                for (j = -100; j < 100; j += 4) {
                    x = i; z = j; y = 25;
                    point = rasterizePoint(x, y, z);
                    if (point.d != -1) {
                        size = 250 / (1 + point.d);
                        d = Math.sqrt(x * x + z * z);
                        a = 0.75 - Math.pow(d / 100, 6) * 0.75;
                        if (a > 0) {
                            ctx.globalAlpha = a;
                            ctx.fillRect(point.x - size / 2, point.y - size / 2, size, size);
                        }
                    }
                }
            }
            ctx.globalAlpha = 1;
            for (i = 0; i < seeds.length; ++i) {
                point = rasterizePoint(seeds[i].x, seeds[i].y, seeds[i].z);
                if (point.d != -1) {
                    size = 200 / (1 + point.d);
                    ctx.fillRect(point.x - size / 2, point.y - size / 2, size, size);
                }
            }
            point1 = new Object();
            for (i = 0; i < sparks.length; ++i) {
                point = rasterizePoint(sparks[i].x, sparks[i].y, sparks[i].z);
                if (point.d != -1) {
                    size = sparks[i].radius * 200 / (1 + point.d);
                    if (sparks[i].alpha < 0) sparks[i].alpha = 0;
                    if (sparks[i].trail.length) {
                        point1.x = point.x;
                        point1.y = point.y;
                        switch (sparks[i].img) {
                            case sparkPics[0]: ctx.strokeStyle = "#f84"; break;
                            case sparkPics[1]: ctx.strokeStyle = "#84f"; break;
                            case sparkPics[2]: ctx.strokeStyle = "#8ff"; break;
                            case sparkPics[3]: ctx.strokeStyle = "#fff"; break;
                            case sparkPics[4]: ctx.strokeStyle = "#4f8"; break;
                            case sparkPics[5]: ctx.strokeStyle = "#f44"; break;
                            case sparkPics[6]: ctx.strokeStyle = "#f84"; break;
                            case sparkPics[7]: ctx.strokeStyle = "#84f"; break;
                            case sparkPics[8]: ctx.strokeStyle = "#fff"; break;
                            case sparkPics[9]: ctx.strokeStyle = "#44f"; break;
                        }
                        for (j = sparks[i].trail.length - 1; j >= 0; --j) {
                            point2 = rasterizePoint(sparks[i].trail[j].x, sparks[i].trail[j].y, sparks[i].trail[j].z);
                            if (point2.d != -1) {
                                ctx.globalAlpha = j / sparks[i].trail.length * sparks[i].alpha / 2;
                                ctx.beginPath();
                                ctx.moveTo(point1.x, point1.y);
                                ctx.lineWidth = 1 + sparks[i].radius * 10 / (sparks[i].trail.length - j) / (1 + point2.d);
                                ctx.lineTo(point2.x, point2.y);
                                ctx.stroke();
                                point1.x = point2.x;
                                point1.y = point2.y;
                            }
                        }
                    }
                    ctx.globalAlpha = sparks[i].alpha;
                    ctx.drawImage(sparks[i].img, point.x - size / 2, point.y - size / 2, size, size);
                }
            }
        }

        function frame() {
            if (frames > 100000) { seedTimer = 0; frames = 0; }
            frames++;
            draw();
            doLogic();
            requestAnimationFrame(frame);
        }

        // å¢å¼ºresizeï¼šä½¿ç”¨dpié€‚é…
        window.addEventListener("resize", () => {
            if (window._resizeTimer) clearTimeout(window._resizeTimer);
            window._resizeTimer = setTimeout(() => {
                const w = canvas.clientWidth, h = canvas.clientHeight;
                if (w && h) {
                    resizeCanvasWithDPI(canvas, w, h);
                    cx = canvas.width / 2 / (window.devicePixelRatio || 1);
                    cy = canvas.height / 2 / (window.devicePixelRatio || 1);
                }
            }, 100);
        });

        // ==================== Shape Shifter æ–‡å­—ç‰¹æ•ˆï¼ˆå…¶å†…éƒ¨å·²ä½¿ç”¨çª—å£å°ºå¯¸ï¼Œä½†æˆ‘ä»¬éœ€è¦ç¡®ä¿canvasæ¸…æ™°ï¼‰ ====================
        var S = {
            init: function () {
                var action = window.location.href, i = action.indexOf('?a=');
                S.Drawing.init('.canvas');
                document.body.classList.add('body--ready');
                if (i !== -1) { S.UI.simulate(decodeURI(action).substring(i + 3)); } 
                else { S.UI.simulate('|Jokingç¥ä½ |2026|æ–°å¹´å¿«ä¹|'); }
                S.Drawing.loop(function () { S.Shape.render(); });
            }
        };

        S.Drawing = (function () {
            var canvas, context, renderFn,
                requestFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function (c) { window.setTimeout(c, 1000 / 60); };
            return {
                init: function (el) {
                    canvas = document.querySelector(el);
                    context = canvas.getContext('2d');
                    this.adjustCanvas();
                    window.addEventListener('resize', function () { S.Drawing.adjustCanvas(); });
                },
                loop: function (fn) {
                    renderFn = !renderFn ? fn : renderFn;
                    this.clearFrame();
                    renderFn();
                    requestFrame.call(window, this.loop.bind(this));
                },
                adjustCanvas: function () {
                    const dpr = window.devicePixelRatio || 1;
                    const w = window.innerWidth, h = window.innerHeight;
                    canvas.style.width = w + 'px';
                    canvas.style.height = h + 'px';
                    canvas.width = w * dpr;
                    canvas.height = h * dpr;
                    context.scale(dpr, dpr);
                },
                clearFrame: function () {
                    context.clearRect(0, 0, canvas.width / (window.devicePixelRatio || 1), canvas.height / (window.devicePixelRatio || 1));
                },
                getArea: function () { return { w: window.innerWidth, h: window.innerHeight }; },
                drawCircle: function (p, c) {
                    context.fillStyle = c.render();
                    context.beginPath();
                    context.arc(p.x, p.y, p.z, 0, 2 * Math.PI, true);
                    context.closePath();
                    context.fill();
                }
            };
        }());

        S.UI = (function () {
            var canvas = document.querySelector('.canvas'), interval, isTouch = false, currentAction, time, maxShapeSize = 30, firstAction = true, sequence = [], cmd = '#';
            function formatTime(date) { var h = date.getHours(), m = date.getMinutes(); m = m < 10 ? '0' + m : m; return h + ':' + m; }
            function getValue(value) { return value && value.split(' ')[1]; }
            function getAction(value) { value = value && value.split(' ')[0]; return value && value[0] === cmd && value.substring(1); }
            function timedAction(fn, delay, max, reverse) {
                clearInterval(interval);
                currentAction = reverse ? max : 1;
                fn(currentAction);
                if (!max || (!reverse && currentAction < max) || (reverse && currentAction > 0)) {
                    interval = setInterval(function () {
                        currentAction = reverse ? currentAction - 1 : currentAction + 1;
                        fn(currentAction);
                        if ((!reverse && max && currentAction === max) || (reverse && currentAction === 0)) clearInterval(interval);
                    }, delay);
                }
            }
            function reset(destroy) { clearInterval(interval); sequence = []; time = null; destroy && S.Shape.switchShape(S.ShapeBuilder.letter('')); }
            function performAction(value) {
                var action, value, current;
                sequence = typeof (value) === 'object' ? value : sequence.concat(value.split('|'));
                timedAction(function (index) {
                    current = sequence.shift();
                    action = getAction(current);
                    value = getValue(current);
                    switch (action) {
                        case 'countdown':
                            value = parseInt(value) || 10; value = value > 0 ? value : 10;
                            timedAction(function (index) {
                                if (index === 0) { if (sequence.length === 0) S.Shape.switchShape(S.ShapeBuilder.letter('')); else performAction(sequence); }
                                else { S.Shape.switchShape(S.ShapeBuilder.letter(index), true); }
                            }, 1000, value, true);
                            break;
                        case 'rectangle':
                            value = value && value.split('x'); value = (value && value.length === 2) ? value : [maxShapeSize, maxShapeSize / 2];
                            S.Shape.switchShape(S.ShapeBuilder.rectangle(Math.min(maxShapeSize, parseInt(value[0])), Math.min(maxShapeSize, parseInt(value[1]))));
                            break;
                        case 'circle':
                            value = parseInt(value) || maxShapeSize; value = Math.min(value, maxShapeSize);
                            S.Shape.switchShape(S.ShapeBuilder.circle(value));
                            break;
                        case 'time':
                            var t = formatTime(new Date());
                            if (sequence.length > 0) { S.Shape.switchShape(S.ShapeBuilder.letter(t)); } 
                            else { timedAction(function () { t = formatTime(new Date()); if (t !== time) { time = t; S.Shape.switchShape(S.ShapeBuilder.letter(time)); } }, 1000); }
                            break;
                        default: S.Shape.switchShape(S.ShapeBuilder.letter(current[0] === cmd ? 'å¦‚æ„' : current));
                    }
                }, 2000, sequence.length);
            }
            function bindEvents() { /* ä¿ç•™ç©ºï¼Œé˜²æ­¢å¹²æ‰°ç‚¹å‡»å¡ç‰‡ */ }
            function init() { bindEvents(); isTouch && document.body.classList.add('touch'); }
            init();
            return { simulate: function (action) { performAction(action); } };
        }());

        S.UI.Tabs = (function () {
            var tabs = document.querySelector('.tabs'), labels = document.querySelector('.tabs-labels'), triggers = document.querySelectorAll('.tabs-label'), panels = document.querySelectorAll('.tabs-panel');
            function activate(i) { triggers[i].classList.add('tabs-label--active'); panels[i].classList.add('tabs-panel--active'); }
            function bindEvents() {
                labels.addEventListener('click', function (e) {
                    var el = e.target, index;
                    if (el.classList.contains('tabs-label')) {
                        for (var t = 0; t < triggers.length; t++) { triggers[t].classList.remove('tabs-label--active'); panels[t].classList.remove('tabs-panel--active'); if (el === triggers[t]) index = t; }
                        activate(index);
                    }
                });
            }
            function init() { activate(0); bindEvents(); }
            init();
        }());

        S.Point = function (args) { this.x = args.x; this.y = args.y; this.z = args.z; this.a = args.a; this.h = args.h; };
        S.Color = function (r, g, b, a) { this.r = r; this.g = g; this.b = b; this.a = a; };
        S.Color.prototype.render = function () { return 'rgba(' + this.r + ',' + this.g + ',' + this.b + ',' + this.a + ')'; };

        S.Dot = function (x, y) {
            this.p = new S.Point({ x: x, y: y, z: 5, a: 1, h: 0 });
            this.e = 0.07;
            this.s = true;
            if (Math.random() < 0.1) {
                this.c = new S.Color(255, 100, 50, this.p.a);
            } else {
                this.c = new S.Color(255, 200, 50, this.p.a);
            }
            this.t = this.clone();
            this.q = [];
        };

        S.Dot.prototype = {
            clone: function () { return new S.Point({ x: this.x, y: this.y, z: this.z, a: this.a, h: this.h }); },
            _draw: function () { this.c.a = this.p.a; S.Drawing.drawCircle(this.p, this.c); },
            _moveTowards: function (n) {
                var details = this.distanceTo(n, true), dx = details[0], dy = details[1], d = details[2], e = this.e * d;
                if (this.p.h === -1) { this.p.x = n.x; this.p.y = n.y; return true; }
                if (d > 1) { this.p.x -= ((dx / d) * e); this.p.y -= ((dy / d) * e); } else { if (this.p.h > 0) { this.p.h--; } else { return true; } }
                return false;
            },
            _update: function () {
                if (this._moveTowards(this.t)) {
                    var p = this.q.shift();
                    if (p) { this.t.x = p.x || this.p.x; this.t.y = p.y || this.p.y; this.t.z = p.z || this.p.z; this.t.a = p.a || this.p.a; this.p.h = p.h || 0; } 
                    else { if (this.s) { this.p.x -= Math.sin(Math.random() * 3.142); this.p.y -= Math.sin(Math.random() * 3.142); } else { this.move(new S.Point({ x: this.p.x + (Math.random() * 50) - 25, y: this.p.y + (Math.random() * 50) - 25, })); } }
                }
                var d = this.p.a - this.t.a; this.p.a = Math.max(0.1, this.p.a - (d * 0.05));
                d = this.p.z - this.t.z; this.p.z = Math.max(1, this.p.z - (d * 0.05));
            },
            distanceTo: function (n, details) { var dx = this.p.x - n.x, dy = this.p.y - n.y, d = Math.sqrt(dx * dx + dy * dy); return details ? [dx, dy, d] : d; },
            move: function (p, avoidStatic) { if (!avoidStatic || (avoidStatic && this.distanceTo(p) > 1)) { this.q.push(p); } },
            render: function () { this._update(); this._draw(); }
        };

        S.ShapeBuilder = (function () {
            var gap = 13, shapeCanvas = document.createElement('canvas'), shapeContext = shapeCanvas.getContext('2d'), fontSize = 500, fontFamily = 'Avenir, Helvetica Neue, Helvetica, Arial, sans-serif';
            function fit() { shapeCanvas.width = Math.floor(window.innerWidth / gap) * gap; shapeCanvas.height = Math.floor(window.innerHeight / gap) * gap; shapeContext.fillStyle = 'red'; shapeContext.textBaseline = 'middle'; shapeContext.textAlign = 'center'; }
            function processCanvas() {
                var pixels = shapeContext.getImageData(0, 0, shapeCanvas.width, shapeCanvas.height).data, dots = [], x = 0, y = 0, fx = shapeCanvas.width, fy = shapeCanvas.height, w = 0, h = 0;
                for (var p = 0; p < pixels.length; p += (4 * gap)) {
                    if (pixels[p + 3] > 0) { dots.push(new S.Point({ x: x, y: y })); w = x > w ? x : w; h = y > h ? y : h; fx = x < fx ? x : fx; fy = y < fy ? y : fy; }
                    x += gap; if (x >= shapeCanvas.width) { x = 0; y += gap; p += gap * 4 * shapeCanvas.width; }
                }
                return { dots: dots, w: w + fx, h: h + fy };
            }
            function setFontSize(s) { shapeContext.font = 'bold ' + s + 'px ' + fontFamily; }
            function isNumber(n) { return !isNaN(parseFloat(n)) && isFinite(n); }
            function init() { fit(); window.addEventListener('resize', fit); }
            init();
            return {
                imageFile: function (url, callback) { var image = new Image(), a = S.Drawing.getArea(); image.onload = function () { shapeContext.clearRect(0, 0, shapeCanvas.width, shapeCanvas.height); shapeContext.drawImage(this, 0, 0, a.h * 0.6, a.h * 0.6); callback(processCanvas()); }; image.onerror = function () { callback(S.ShapeBuilder.letter('ç¦?')); }; image.src = url; },
                circle: function (d) { var r = Math.max(0, d) / 2; shapeContext.clearRect(0, 0, shapeCanvas.width, shapeCanvas.height); shapeContext.beginPath(); shapeContext.arc(r * gap, r * gap, r * gap, 0, 2 * Math.PI, false); shapeContext.fill(); shapeContext.closePath(); return processCanvas(); },
                letter: function (l) { var s = 0; setFontSize(fontSize); s = Math.min(fontSize, (shapeCanvas.width / shapeContext.measureText(l).width) * 0.8 * fontSize, (shapeCanvas.height / fontSize) * (isNumber(l) ? 1 : 0.45) * fontSize); setFontSize(s); shapeContext.clearRect(0, 0, shapeCanvas.width, shapeCanvas.height); shapeContext.fillText(l, shapeCanvas.width / 2, shapeCanvas.height / 2); return processCanvas(); },
                rectangle: function (w, h) { var dots = [], width = gap * w, height = gap * h; for (var y = 0; y < height; y += gap) { for (var x = 0; x < width; x += gap) { dots.push(new S.Point({ x: x, y: y })); } } return { dots: dots, w: width, h: height }; }
            };
        }());

        S.Shape = (function () {
            var dots = [], width = 0, height = 0, cx = 0, cy = 0;
            function compensate() { var a = S.Drawing.getArea(); cx = a.w / 2 - width / 2; cy = a.h / 2 - height / 2; }
            return {
                shuffleIdle: function () { var a = S.Drawing.getArea(); for (var d = 0; d < dots.length; d++) { if (!dots[d].s) { dots[d].move({ x: Math.random() * a.w, y: Math.random() * a.h }); } } },
                switchShape: function (n, fast) { var size, a = S.Drawing.getArea(); width = n.w; height = n.h; compensate(); if (n.dots.length > dots.length) { size = n.dots.length - dots.length; for (var d = 1; d <= size; d++) { dots.push(new S.Dot(a.w / 2, a.h / 2)); } } var d = 0, i = 0; while (n.dots.length > 0) { i = Math.floor(Math.random() * n.dots.length); dots[d].e = fast ? 0.25 : (dots[d].s ? 0.14 : 0.11); if (dots[d].s) { dots[d].move(new S.Point({ z: Math.random() * 20 + 10, a: Math.random(), h: 18 })); } else { dots[d].move(new S.Point({ z: Math.random() * 5 + 5, h: fast ? 18 : 30 })); } dots[d].s = true; dots[d].move(new S.Point({ x: n.dots[i].x + cx, y: n.dots[i].y + cy, a: 1, z: 5, h: 0 })); n.dots = n.dots.slice(0, i).concat(n.dots.slice(i + 1)); d++; } for (var i = d; i < dots.length; i++) { if (dots[i].s) { dots[i].move(new S.Point({ z: Math.random() * 20 + 10, a: Math.random(), h: 20 })); dots[i].s = false; dots[i].e = 0.04; dots[i].move(new S.Point({ x: Math.random() * a.w, y: Math.random() * a.h, a: 0.3, z: Math.random() * 4, h: 0 })); } } },
                render: function () { for (var d = 0; d < dots.length; d++) { dots[d].render(); } }
            };
        }());

        // ==================== 2Dç‚¹å‡»çƒŸèŠ± (fireworkCanvas) å¢å¼ºé¢œè‰²å¤šæ ·æ€§ & é€‚é…DPI ====================
        const fireworkCanvas = document.getElementById('fireworkCanvas');
        let fwCtx = fireworkCanvas.getContext('2d', { willReadFrequently: false });

        fwCtx.imageSmoothingEnabled = true;
        fwCtx.imageSmoothingQuality = 'high';

        function resizeFireworkCanvas() {
            const w = window.innerWidth, h = window.innerHeight;
            const dpr = window.devicePixelRatio || 1;
            fireworkCanvas.style.width = w + 'px';
            fireworkCanvas.style.height = h + 'px';
            fireworkCanvas.width = w * dpr;
            fireworkCanvas.height = h * dpr;
            fwCtx = fireworkCanvas.getContext('2d', { willReadFrequently: false });
            fwCtx.scale(dpr, dpr);
            fwCtx.imageSmoothingEnabled = true;
            fwCtx.imageSmoothingQuality = 'high';
        }
        resizeFireworkCanvas();
        window.addEventListener('resize', () => {
            clearTimeout(resizeFireworkCanvas.timeout);
            resizeFireworkCanvas.timeout = setTimeout(resizeFireworkCanvas, 100);
        });

        const fwRandom = (min, max) => Math.random() * (max - min) + min;
        const fwRandomInt = (min, max) => (Math.random() * (max - min + 1) + min) | 0;

        function fwGetRandomColor() {
            let hue;
            if (Math.random() < 0.7) {
                if (Math.random() < 0.8) { hue = fwRandomInt(0, 60); } else { hue = fwRandomInt(340, 360); }
            } else {
                hue = fwRandomInt(0, 360);
            }
            return `hsl(${hue}, 85%, 60%)`;
        }

        class FWVector { constructor(x = 0, y = 0) { this.x = x; this.y = y; } add(v) { this.x += v.x; this.y += v.y; return this; } scale(s) { this.x *= s; this.y *= s; return this; } static add(v1, v2) { return new FWVector(v1.x + v2.x, v1.y + v2.y); } static scale(v, s) { return new FWVector(v.x * s, v.y * s); } }
        class FWParticle {
            constructor(x, y, velocity, color, isFirework = false) {
                this.pos = new FWVector(x, y); this.vel = velocity; this.color = color; this.isFirework = isFirework;
                this.life = isFirework ? 30 : fwRandomInt(40, 80); this.size = isFirework ? fwRandom(2, 4) : fwRandom(1, 3); this.gravity = isFirework ? 0.05 : 0.1;
            }
            update() { this.vel.y += this.gravity; this.vel.scale(0.98); this.pos.add(this.vel); this.life--; return this.life > 0; }
            draw() { const alpha = this.life / (this.isFirework ? 30 : 80); fwCtx.globalAlpha = alpha * 0.8; fwCtx.fillStyle = this.color; fwCtx.beginPath(); fwCtx.arc(this.pos.x, this.pos.y, this.size, 0, Math.PI * 2); fwCtx.fill(); }
        }
        class FWFirework {
            constructor(x = null) {
                this.color = fwGetRandomColor(); this.particles = []; this.isExploded = false;
                const startX = x !== null ? x : fwRandomInt(0, window.innerWidth);
                const startY = window.innerHeight + 10;
                this.fireworkParticle = new FWParticle(startX, startY, new FWVector(fwRandom(-1, 1), fwRandom(-15, -20)), this.color, true);
                this.explosionHeight = fwRandomInt(window.innerHeight * 0.1, window.innerHeight * 0.5);
            }
            update() {
                if (!this.isExploded) { const alive = this.fireworkParticle.update(); this.fireworkParticle.draw(); if (!alive || this.fireworkParticle.pos.y <= this.explosionHeight) { this.explode(); this.isExploded = true; } return true; }
                else { this.particles = this.particles.filter(p => p.update()); this.particles.forEach(p => p.draw()); return this.particles.length > 0; }
            }
            explode() { const particleCount = fwRandomInt(50, 100); for (let i = 0; i < particleCount; i++) { const angle = fwRandom(0, Math.PI * 2); const speed = fwRandom(1, 6); const velocity = new FWVector(Math.cos(angle) * speed, Math.sin(angle) * speed); this.particles.push(new FWParticle(this.fireworkParticle.pos.x, this.fireworkParticle.pos.y, velocity, this.color)); } }
        }

        let fwFireworks = []; let fwLastTime = 0; const fwMaxFireworks = 8;
        function fwInitFireworks() { for (let i = 0; i < 3; i++) { setTimeout(() => { if (fwFireworks.length < fwMaxFireworks) { fwFireworks.push(new FWFirework()); } }, i * 300); } }
        function fwAnimate(timestamp) {
            requestAnimationFrame(fwAnimate);
            if (timestamp - fwLastTime < 16) return; fwLastTime = timestamp;
            fwCtx.fillStyle = 'rgba(0, 0, 0, 0.1)'; fwCtx.fillRect(0, 0, window.innerWidth, window.innerHeight); fwCtx.globalAlpha = 1;
            if (Math.random() > 0.85 && fwFireworks.length < fwMaxFireworks) { fwFireworks.push(new FWFirework()); }
            fwFireworks = fwFireworks.filter(firework => { const alive = firework.update(); if (!alive && Math.random() > 0.5 && fwFireworks.length < fwMaxFireworks) { return true; } return alive; });
            if (Math.random() > 0.95 && fwFireworks.length < fwMaxFireworks) { const miniFirework = new FWFirework(fwRandomInt(50, window.innerWidth - 50)); miniFirework.fireworkParticle.vel.y = -fwRandom(18, 22); fwFireworks.push(miniFirework); }
        }
        fireworkCanvas.addEventListener('click', (e) => {
            if (fwFireworks.length >= fwMaxFireworks) return;
            const rect = fireworkCanvas.getBoundingClientRect();
            const scaleX = fireworkCanvas.width / rect.width / (window.devicePixelRatio || 1);
            const x = (e.clientX - rect.left) * scaleX;
            const firework = new FWFirework(x);
            firework.explosionHeight = fwRandomInt(window.innerHeight * 0.1, window.innerHeight * 0.4);
            fwFireworks.push(firework);
        });

        // ==================== æ¨ªå±æ£€æµ‹ä¸æç¤º ====================
        const rotateHint = document.getElementById('rotateHint');
        function checkOrientation() {
            // å¦‚æœé«˜åº¦å¤§äºå®½åº¦ï¼Œè®¤ä¸ºæ˜¯ç«–å±
            if (window.innerHeight > window.innerWidth) {
                rotateHint.classList.add('visible');
            } else {
                rotateHint.classList.remove('visible');
            }
        }
        // åˆå§‹æ£€æµ‹
        checkOrientation();
        // ç›‘å¬resizeå’Œorientationchange
        window.addEventListener('resize', checkOrientation);
        window.addEventListener('orientationchange', checkOrientation);

        // ==================== æ’­æ”¾å¡ç‰‡ç‚¹å‡»ï¼šå¯åŠ¨ä¸€åˆ‡ï¼Œå¹¶å¼€å¯fireworkCanvasçš„ç‚¹å‡»äº‹ä»¶ ====================
        document.getElementById('playCard').addEventListener('click', function() {
            const bgMusic = document.getElementById('bgMusic');
            bgMusic.play().catch(e => console.log('éŸ³é¢‘æ’­æ”¾éœ€ç”¨æˆ·äº¤äº’:', e));

            this.style.opacity = '0';
            this.style.pointerEvents = 'none';
            setTimeout(() => { this.style.display = 'none'; }, 400);

            // æ˜¾ç¤ºæ‰€æœ‰canvas
            document.getElementById('fireworkCanvas').style.opacity = '1';
            document.getElementById('canvas').style.opacity = '1';
            document.querySelector('.canvas').style.opacity = '1';

            // å…è®¸fireworkCanvasæ¥æ”¶ç‚¹å‡»
            fireworkCanvas.style.pointerEvents = 'auto';

            // å¯åŠ¨æ‰€æœ‰çƒŸèŠ±å¼•æ“
            initVars();
            frame();
            S.init();
            fwInitFireworks();
            fwAnimate();
        });

        // åå¤‡ï¼šå¦‚æœç”¨æˆ·ç‚¹å‡»å…¶ä»–åœ°æ–¹ä¹Ÿå°è¯•æ’­æ”¾éŸ³ä¹ï¼ˆä½†å¡ç‰‡æ¶ˆå¤±åä¸å½±å“ï¼‰
        document.body.addEventListener('click', function() {
            const bgMusic = document.getElementById('bgMusic');
            if (bgMusic.paused) {
                bgMusic.play().catch(e => console.log('å¤‡ç”¨æ’­æ”¾å¤±è´¥:', e));
            }
        }, { once: true });
    </script>
</body>
</html>
